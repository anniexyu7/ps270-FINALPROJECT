---
title: "PS270 Final Project"
author: "Annie Yu"
description: "My final project"
output:
  distill::distill_article:
    self_contained: false
---

## (1) Introduction 

Mass incarceration and high recidivism rates have defined the American criminal justice system for decades. Expedited by the War on Drugs and perpetuated by the policies and stigmas surrounding incarcerated individuals post-release, it is pertinent to public health that the underlying mechanisms driving such a concern is better understood. Surprisingly, there is a lack of longitudinal research that specifically isolates the relationship between the presence of substance use and the likelihood of recidivism.

Because co-occurring disorders are common, it is difficult to isolate a control group of inmates who have never struggled with substance use and are honest about it. It is even harder to follow this sample across an extended period of time to determine if they re-offended or if they have introduced drugs into their lifestyles. This report seeks to answer the question: how does recidivism vary among those who experience substance use? I take a different route in examining the relationship between substance use and recidivism by focusing on specific crime categories—violent, property, drug, and public order offenses—then analyzing how substance use trends within these categories relate to the tendency towards recidivism. 

My hypothesis assumes that substance use is an underlying mechanism that influences what crime an individual is likely to commit and therefore how likely recidivism is for them. I come to this conclusion by taking into the lifelong ramifications that substance use has on an individual and its interconnected character that affects all aspects of an individual: physical health, mental health, socioeconomic tendencies, behavior, and cognition. Therefore, I predict that those who struggle with substance use are more likely to commit crimes that are likely to be re-offended, resulting in higher rearrest, reincarceration, and reconviction rates of individuals with problematic substance use. 

The primary explanatory variable is the presence of substance use in an individual's life. This can be measured during the screening and assessment process of intake for correctional facilities, drug testing, self-reported surveys, and medical records. These records alone will show variation among the sample, because those incarcerated now or in the past have different histories with substance use along with varying levels of severity when it comes to disorders. This approach must be longitudinal, because we must see changes or lack of changes in substance use over the span of their life before and during incarceration, along with the three years following their release. That way, we can see at what points in time substance use was at its peak in relation to their criminal behavior. 

The outcome variable of interest is the rate of recidivism for each individual. This is typically measured by the number of re-arrests, re-convictions, and re-incarcerations that occur within three years of being released from jail/prison, including those released on extended supervision/parole. This data is typically public information. 

One observed pattern in the data that would provide support for my hypothesis is higher recidivism rates among those struggling with one or more substance use disorders. 

An observed pattern that would disprove my hypothesis is higher recidivism rates among those without the presence of substance use or those with relatively low levels of substance use. This would mean that substance use is not a causal indicator of high recidivism and that there is a confounding variable that has a larger effect on the likelihood that an individual will re-offend. For instance, mental illness, employment, environment, housing, education, etc.  

## (2) Data 

To give a general idea of the relationship between substance users and the likelihood of recidivism, figure 1 reflects the disparity between the rearrest rates of those without the presence of substance use compared to those who do. The independent, or explanatory variable, the presence of substance use, has been measured using 36 months of post-release records for New Jersey state inmates. Since this type of study uses data over time, it can be best classified as longitdinal and retrospective in nature. The dependent, or outcome, variable has also been measured by using government clinical records. Clinical records has multiple points of sources, likely a combination of screenings, clinical assessments, and documentation from correctional facilities. Statistical analysis also aided the process of organizing the data. 

Data source: Zgoba, K. M., Reeves, R., Tamburello, A., & Debilio, L. (2020). Criminal Recidivism in Inmates with Mental Illness and Substance Use Disorders

```{r}

library(tidyverse) 
library(infer) 

data_1 <- read_csv("/Users/annieyu/Documents/finalprojectdata.csv")

data_long <- data_1 |>
  select(sud_rearrest, no_sud_rearrest) |>
  pivot_longer(
    cols = sud_rearrest : no_sud_rearrest,
    names_to = "variable",
    values_to = "value")

dataplot <- ggplot(data_long, 
                   aes(x = variable,
                       y = value,
                       fill = variable)) +
  geom_bar(stat = "identity") +
  labs(title = "Figure 1: Rearrests Among Those With/Without Presence of Substance Use", 
       x = "Sample Groups", 
       y = "Rearrest Rate (%)",
       caption = "Data source: Zgoba, K. M., Reeves, R., Tamburello, A., & Debilio, L. (2020). Criminal Recidivism in Inmates with Mental Illness and Substance Use Disorders ",
       fill = "Sample Groups") +
  ylim(0,80) + 
  scale_x_discrete(labels = c(
    "sud_rearrest" = "Substance Use Present",
    "no_sud_rearrest" = "No Substance Use")) +
  scale_fill_manual(values = c(
    "sud_rearrest" = "#1f78b4",
    "no_sud_rearrest" = "#33a02c"),
    labels = c(
      "sud_rearrest" = "Presence of Substance Use On Release",
      "no_sud_rearrest" = "No Presence of Subtance Use On Release")) +
  theme_minimal() +
  theme(panel.background = element_blank(),
        plot.caption = element_text(hjust = 0.1, size = 5),
        plot.title = element_text(size = 14, face = "bold", hjust = 0.1),
    axis.title = element_text(size = 12, face = "bold")
  )


dataplot
```

## Results

The second set of data in Figure 2 comes from the New Survey of Prison Inmates Data Analysis Tool (SPI DAT) from the Bureau of Justice Statistics. It's a dynamic tool that allows public access to interact with data visualizations, with custom charts for a range of characteristics of incarcerated individuals in 2016. The data comes from a national survey of prisoners aged 18 or older in both state and federal correctional facilities. Prisoners with a substance use disorder (SUD) fulfill the criteria for the DSM-IV for either dependence or abuse of alcohol or drugs 12 months prior to incarceration. 

```{r}
sud_by_offense <- read_csv("/Users/annieyu/Documents/ps270finalproject/sud_by_offense_2016.csv")

off_data <- sud_by_offense |>
  mutate(SUD = 
           if_else( sud == "Yes", 1, 0))
off_data

off_data_plot <- off_data |>
  ggplot(aes(x = offense_type,
             y = Perc, 
             fill = as.factor(SUD))) + 
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(values = c("0" = "#33a02c",
                               "1" = "#1f78b4"),
                    labels = c("No SUD", "Yes SUD")) +
  scale_x_discrete(labels = c(
                               "drug" = "Drug",
                               "other" = "Other",
                               "property" = "Property",
                               "public_order" = "Public Order",
                               "violent" = "Violent")) +
  ylim(0,100) +
  labs(
    title = "Figure 2: Types of Offenses and SUD Presence in Offenders",
    x = "Type of Offense",
    y = "Percentage of Offenses Committed",
    fill = "Offender SUD Status",
    caption = "Data source: New Survey of Prison Inmates Data Analysis Tool (SPI DAT) from the Bureau of Justice Statistics") +
  theme_minimal() +
  theme(panel.background = element_blank(),
        plot.caption = element_text(hjust = 0.5, size = 5),
        plot.title = element_text(size = 14, face = "bold", hjust = 0.1),
    axis.title = element_text(size = 12, face = "bold"))

off_data_plot
```
Regression 

This third dataset comes from the Wisconsin Department of Corrections. The recidivism calculations of rearrest, reincarceration, and reconviction contain 3 components: report of release date, a 3-year follow-up period, and the documentation of a recidivism event. The sample is all persons released from prison in Wisconsin from 2000-2016.

```{r}
raoodata <- read_csv("/Users/annieyu/Documents/ps270finalproject/rearrest_by_original_offense.csv")

head(raoodata)

raoodata_summary <- raoodata |>
  summarize(
    "Drug Offenses" = mean(total_recid_drug_perc * 100),
    "Property Offenses" = mean(total_recid_prop_perc * 100),
    "Public Order Offenses" = mean(total_recid_pub_perc * 100),
    "Violent Crime Offenses" = mean(total_recid_vio_perc * 100)) |>
  pivot_longer(
    cols = everything(), 
    names_to = "offense_type", 
    values_to = "rearrest_rate")

raoodata_sum_table <- raoodata_summary |>
  knitr::kable(digits = 2, caption = "Average Rearrest Rates by Offense Type")
raoodata_sum_table
```

```{r}
rearrest_long <- raoodata |>
  pivot_longer(
    cols = starts_with("total_recid"),
    names_to = "offense_type",
    values_to = "rearrest_rate") |>
  mutate(crime_type = case_when(
    offense_type == "total_recid_drug_perc" ~"Drug",
    offense_type == "total_recid_prop_perc" ~ "Property",
    offense_type == "total_recid_pub_perc" ~ "Public Order",
    offense_type == "total_recid_vio_perc" ~ "Violent"),
    control_group = if_else(
      offense_type == "Violent", 1, 0))
knitr::kable(head(rearrest_long, 5))
```

Bootstrapping Model

As shown in the visualization, the bootstrapping model isn't compatible with the data set, because the same size is not extensive enough to generate a solid null distribution. An F-statistic is being used instead of difference in proportions or difference in means, because I am trying to measure the variability between the rearrest rates of 4 types of crime. Additionally, I am trying to evaluate whether the difference in the average rearrest rates are statistically significant compared to the overall variability in the data. The dashed line shows the standard deviation of the distribution and the black line represents the density curve of the permutations.  

```{r}
null_dist <- rearrest_long |>
  specify(rearrest_rate ~ crime_type) |>
  hypothesize(null = "independence") |>
  generate(reps = 1000, type = "permute") |>
  calculate(stat = "F")

observed_stat <- rearrest_long |>
  specify(rearrest_rate ~ crime_type) |>
  calculate(stat = "F")

ci_95 <- null_dist |>
  get_confidence_interval(level = 0.95, type = "percentile")

rearrest_pval <- null_dist |>
  get_p_value(obs_stat = observed_stat, direction = "greater")

knitr::kable(head(null_dist, 5))
knitr::kable(observed_stat)
knitr::kable(ci_95)
knitr::kable(rearrest_pval)
```

```{r}
null_dist_plot <- null_dist |>
  ggplot(aes(x = stat)) +
  geom_histogram(aes(y = after_stat(density)),
                 binwidth = 0.2, fill = "grey") +
  geom_density(color = "#1f78b4", size = 1) +
  stat_function(
    fun = dnorm,
    args = list(mean = mean(null_dist$stat), sd = sd(null_dist$stat)),
    color = "black",
    linetype = "dashed",
    size = 1
  ) +
  labs(
    title = "Simulation-Based Null Distribution with Normal Curve",
    x = "F-Statistic",
    y = "Density"
  ) +
  theme_minimal() +
  theme(panel.background = element_blank(),
        plot.caption = element_text(hjust = 0.1, size = 5),
        plot.title = element_text(size = 14, face = "bold", hjust = 0.1),
    axis.title = element_text(size = 12, face = "bold")
  )

null_dist_plot
```

Linear Regression of Rearrests

```{r}
rearrest_long <- rearrest_long |>
  mutate(crime_type = factor(crime_type, levels = c("Violent", "Drug", "Property", "Public Order")))

lm_rearrest <- lm(rearrest_rate ~ crime_type, data = rearrest_long)

modelsummary::modelsummary(lm_rearrest, statistic = c("s.e. = {std.error}",
                                         "p = {p.value}"),
                           gof_map = c("nobs", "r.squared","adj.r.squared"))
```

The regression table shows that when $\alpha$ = 0.05, property offenses significantly predict higher rearrest rates, with an increase of 12.31 percentage points compared to violent offenses. Violent offenses was used as a reference group, since it had the lowest rearrest rate of the 4 categories. Drug offenses and public order offenses also predict higher rearrest rates, but only with increases of 5.45 and 3.69 percentage points. This suggests that property offenses have the strongest association with rearrest rates among these four main crime categories. The p-value of <0.001 means that we can reject the null hypothesis that there is no significant association one's original offense of a property crime and the likelihood of rearrest within 3 years post-release. 

This analysis only shows a correlation, not a causal effect. Aspects like age, gender, race, socioeconomic status, etc. have not been accounted for because that information is not public information. 

ignore---------------

note --- the most common offenses in property offense is burglary-Biulding or Dwelling, Forgery-Uttering, Misappropriate ID info-Obtain Money, Theft-Movable Property =< $2,500, and Take and Drive Vehicle w/o consent. 

Drug Offense: 
possession of NArcotic Drugs
Manufacture/Deliver Heroin <3g
Possession of THC (2nd+ Offense)
Possess w/Intent - THC (<= 200 grams)
Manufacture/Deliver Cocain (<= 1g)

Public Order Offense: 
Operating While under the Influence (5th or 6th)
Possession of Firearm by Felon
Operating While Under the Influence (7th, 8th, or 9th)
OWI (4th within 5 yrs)
Bail Jumping - Felony

Violent Offense: 
2nd Degree Sexual Assault of Child
Armed Robbery
Substantial Battery-Intend Bodily Harm
2nd Degree Recklessly Endangering Safety
Battery 
## Results

---------

## Summary

 1 paragraph (i) summarizing results and assessing the extent to which you find support for your hypothesis; (ii) describing limitations of the analysis and threats to inference (missing data, confounding, etc), and stating how you could improve your analysis if you had more time/money. (2pts)




limitations to analysis: lack of longitudinal data following individuals due to HIPPA, lack of knowledge of true nature fo substance use (what drugs are used the most and to what extent)




## Works Cited

https://www.unodc.org/documents/ungass2016/Contributions/Civil/DrugPolicyAlliance/DPA_Fact_Sheet_Drug_War_Mass_Incarceration_and_Race_June2015.pdf

https://spi-data.bjs.ojp.gov/





## Project thoughts

I am interested in exploring data related to the relationship between the likelihood of recidivism and the presence of substance use.  

## Milestone 2

My research question: How does the presence of substance use affect the likelihood of recidivism after incarceration?

Hypothesis: The presence of substance use increases the likelihood of recidivism due to the cyclical nature of addiction, isolation/difficulty reengaging with society, lack of rehabilitation treatment centers within jail/prison, and punitive nature of sentencing for drug-related crimes.

  

## Milestone 3

-------------------- -----------------------------------------------------------
 Name                 Description
 -------------------- ----------------------------------------------------------
 `num_male`           number of males in the full sample

 `num_females`        number of females in the full sample

 `white`              number of racially/ethnically White individuals

 `black`              number of racially/ethnically Black individuals
 
 `hispanic`           number of racially/ethnically Hispanic individuals
 
 `single`             number of individuals whose marital status is single
 
 `married `           number of individuals whose marital status is married
 
 `divorced`           number of individuals whose marital status is divorced
 
 `separated`          number of individuals whose marital status is separated
 
 `widowed`            number of individuals whose marital status is widowed
 
 `some_school`        number of individuals who have completed some education
 
 `hs_grad`            number of individuals who have completed high school
 
 `some_col`           number of individuals who have completed some college
 
 `sud_or`             percentage of sample who have shown a presence of substance use on release of incarceration
 
 `no_sud_or`          percentage of sample who have not shown a presence of substance use on release of incarceration

 `sud_rearrest`       percentage of sample who have shown a presence of substance use and have gotten rearrested within 36 months of release
 
 `no_sud_rearrest`    percentage of sample who have not shown a presence of substance use and have gotten rearrested within 36 months of release
 
--------------------------------------------------------------------------------


The percentage of the sample of who did not show a presence of substance use on release of incarceration had a smaller percentage of individuals who were rearrested within 36 months of release than the group who did show a presence of substance use on release of incarceration. It does not, however, indicate differences in gender or race/ethnicity. It also does not specify what the rearrest charge was or whether it resulted in a re-conviction or return to prison. 


## Milestone 4


WISCONSIN DOC DATASET: SUBSTANCE USE DISORDER PROGRAM REARREST RATES

-------------------- ----------------------------------------------------------
 Name                 Description
 -------------------- ----------------------------------------------------------
 `year`               date of release from incarceration

 `Treated`            Individuals with a drug history who participated in a substance use treatment program after release of                         incarceration

 `Control`            Individuals with a drug history who did not participate in a substance use treatment program after                             release of incarceration

 `followup_period`    1-Year, 2-Year, or 3-Year post-release check-up on participants

 `num_releases`       number of individuals in the study released at a given year

 `rearrest_perc`      rearrest rate for individuals in study
 ------------------------------------------------------------------------------



```{r}
data <- read_csv("/Users/annieyu/Documents/ps270milestone4data.csv")

widata <- data |>
  select(year, followup_period, group, rearrest_perc) |>
  pivot_wider(
    names_from = group,
    values_from = rearrest_perc) |>
  drop_na()

widataplot <- widata |>
  ggplot() +
  geom_smooth(aes(x = followup_period,
                  y = Treated,
                  color = "Received Treatment Post-Release", group = 1),
              method = "lm", se = FALSE) +
  geom_smooth(aes(x = followup_period,
                  y = Control,
                  color = "No Treatment Post-Release", group = 1),
              method = "lm", se = FALSE) +
  geom_smooth(aes(x = followup_period,
                  y = Total,
                  color = "Total Rearrests in WI", group = 1), 
                  method = "lm", se = FALSE) +
  scale_color_manual(values = c(
    "Received Treatment Post-Release" = "#1f78b4",
    "No Treatment Post-Release" = "#33a02c",
    "Total Formerly-Incarcerated Population" = "black")) +
  labs(
    title = "Rearrest Rates Among WI DOC Substance Use Treatment Participants",
    x = "Follow-up Periods",
    y = "Rearrest Rate (%)",
    color = "Sample Groups",
    caption = "Data Source: doc.wi.gov/DataResearch/RecidivismReincarceration/Primary%20Program%20Report_2022_FINAL.pdf") +
  ylim(10,60) +
  theme_minimal() +
    theme(plot.title = element_text(face = "bold"),
          axis.title.x = element_text(size = 11, face = "bold"),
          axis.title.y = element_text(size = 11, face = "bold"),
           plot.caption = element_text(hjust = 0.5, size = 5))
            

widataplot
```
The data source, the Wisconsin Department of Corrections Primary Programs Report includes data on individuals who entered substance use treatment after their release from incarceration, specifically within the state. Notably, this does not necessarily mean that those with a drug offense entered these programs and it also does not include every person with a drug history, just those included in the study. 

The relationship shown above indicates that those who participated in the program experienced, on average, less rearrests than those with similar drug histories but who did not participate in treatment. The black line provides insight into how this group compares to the overall rearrest rate. The plot emphasizes again, that those experiencing substance use have relatively higher rearrest rates than the formerly incarcerated population as a whole . The periods where the treatment group showed a smaller rearrest rate than that of the total provides valuable insight into the potential of treatment in reducing overall recidivism. 

In regards to future research, the upwards progression over time of rearrests for all groups is valuable for identifying at which point treatment should be implemented when it is most effective post-release. There may be underlying mechanisms that accumulate over time and increasingly pull individuals toward criminogenic behavior. This puts into question the need for long-term, sustained interventions that emphasize smooth transition periods.




